00:00 +0: loading test/core/security/security_manager_test.dart
00:00 +0: SecurityManager should initialize with locked keystore
00:00 +1: SecurityManager should unlock keystore with password
00:00 +1: SecurityManager should initialize with locked keystore
2026-01-09T00:38:49.717122 [INFO] [SecurityManager] [INFO] Encrypted keystore unlocked
00:00 +2: SecurityManager should lock keystore
00:00 +2: SecurityManager should initialize with locked keystore
2026-01-09T00:38:49.952040 [INFO] [SecurityManager] [INFO] Encrypted keystore unlocked
2026-01-09T00:38:49.952350 [INFO] [SecurityManager] [INFO] Encrypted keystore locked
00:00 +3: SecurityManager should enforce rate limiting
00:00 +4: SecurityManager should track auth attempts
00:00 +5: SecurityManager should generate secure key when unlocked
00:00 +5: SecurityManager should initialize with locked keystore
2026-01-09T00:38:50.171464 [INFO] [SecurityManager] [INFO] Encrypted keystore unlocked
2026-01-09T00:38:50.194920 [INFO] [SecurityManager] [INFO] Generated secure key: test_key
00:00 +6: SecurityManager should throw error when accessing keys while locked
00:00 +7: SecurityManager migrateKeysFromPlaintext - success
00:00 +7: SecurityManager should initialize with locked keystore
2026-01-09T00:38:50.197524 [INFO] [Keystore] [INFO] Added key pair for legacy_key.
2026-01-09T00:38:50.449234 [INFO] [SecurityManager] [INFO] Encrypted keystore unlocked
2026-01-09T00:38:50.449623 [WARNING] [Keystore] [WARNING] Exporting plaintext keys for migration - ensure they are encrypted!
2026-01-09T00:38:50.450038 [INFO] [SecurityManager] [INFO] Migrating 1 keys to encrypted storage
2026-01-09T00:38:50.450264 [SEVERE] [SecurityManager] [ERROR] Failed to migrate key legacy_key
Error: Invalid argument(s): Seed must be 32 bytes
Stack trace: null
00:01 +7 -1: SecurityManager migrateKeysFromPlaintext - success [E]
  Expected: <1>
    Actual: <0>
  
  package:matcher                                      expect
  test/core/security/security_manager_test.dart 123:7  main.<fn>.<fn>
  
00:01 +7 -1: SecurityManager migrateKeysFromPlaintext - skip existing
00:01 +7 -1: SecurityManager should initialize with locked keystore
2026-01-09T00:38:50.712371 [INFO] [SecurityManager] [INFO] Encrypted keystore unlocked
2026-01-09T00:38:50.714262 [INFO] [SecurityManager] [INFO] Generated secure key: existing_key
2026-01-09T00:38:50.714343 [INFO] [Keystore] [INFO] Added key pair for existing_key.
2026-01-09T00:38:50.714440 [WARNING] [Keystore] [WARNING] Exporting plaintext keys for migration - ensure they are encrypted!
2026-01-09T00:38:50.714507 [INFO] [SecurityManager] [INFO] Migrating 1 keys to encrypted storage
00:01 +8 -1: SecurityManager migrateKeysFromPlaintext - locked error
00:01 +9 -1: SecurityManager TLS initialization error - missing paths
00:01 +9 -1: SecurityManager should initialize with locked keystore
2026-01-09T00:38:50.715746 [SEVERE] [SecurityManager] [ERROR] Failed to initialize SecurityManager
Error: Bad state: TLS enabled but certificate or private key path not provided
Stack trace: #0      SecurityManager._initializeTLS (package:dart_ipfs/src/core/security/security_manager.dart:188:7)
#1      SecurityManager._initializeSecurity (package:dart_ipfs/src/core/security/security_manager.dart:169:9)
#2      new SecurityManager (package:dart_ipfs/src/core/security/security_manager.dart:26:5)
#3      main.<anonymous closure>.<anonymous closure>.<anonymous closure> (file:///Users/meilynlopezcubero/IPFS/test/core/security/security_manager_test.dart:148:15)
#4      Throws.matchAsync (package:matcher/src/expect/throws_matcher.dart:85:37)
#5      _expect (package:matcher/src/expect/expect.dart:137:26)
#6      expect (package:matcher/src/expect/expect.dart:65:3)
#7      main.<anonymous closure>.<anonymous closure> (file:///Users/meilynlopezcubero/IPFS/test/core/security/security_manager_test.dart:147:7)
#8      Declarer.test.<anonymous closure>.<anonymous closure> (package:test_api/src/backend/declarer.dart:253:25)
<asynchronous suspension>
#9      Declarer.test.<anonymous closure> (package:test_api/src/backend/declarer.dart:250:11)
<asynchronous suspension>
#10     Invoker._waitForOutstandingCallbacks.<anonymous closure> (package:test_api/src/backend/invoker.dart:318:9)
<asynchronous suspension>

00:01 +10 -1: SecurityManager TLS initialization error - missing files
00:01 +10 -1: SecurityManager should initialize with locked keystore
2026-01-09T00:38:50.716404 [SEVERE] [SecurityManager] [ERROR] Failed to initialize SecurityManager
Error: FileSystemException: TLS certificate file not found, path = 'non_existent_cert'
Stack trace: #0      SecurityManager._initializeTLS (package:dart_ipfs/src/core/security/security_manager.dart:195:7)
#1      SecurityManager._initializeSecurity (package:dart_ipfs/src/core/security/security_manager.dart:169:9)
#2      new SecurityManager (package:dart_ipfs/src/core/security/security_manager.dart:26:5)
#3      main.<anonymous closure>.<anonymous closure>.<anonymous closure> (file:///Users/meilynlopezcubero/IPFS/test/core/security/security_manager_test.dart:160:15)
#4      Throws.matchAsync (package:matcher/src/expect/throws_matcher.dart:85:37)
#5      _expect (package:matcher/src/expect/expect.dart:137:26)
#6      expect (package:matcher/src/expect/expect.dart:65:3)
#7      main.<anonymous closure>.<anonymous closure> (file:///Users/meilynlopezcubero/IPFS/test/core/security/security_manager_test.dart:159:7)
#8      Declarer.test.<anonymous closure>.<anonymous closure> (package:test_api/src/backend/declarer.dart:253:25)
<asynchronous suspension>
#9      Declarer.test.<anonymous closure> (package:test_api/src/backend/declarer.dart:250:11)
<asynchronous suspension>
#10     Invoker._waitForOutstandingCallbacks.<anonymous closure> (package:test_api/src/backend/invoker.dart:318:9)
<asynchronous suspension>

00:01 +11 -1: SecurityManager Key rotation timer setup
00:01 +12 -1: SecurityManager getPrivateKey fallback - secure key
00:01 +12 -1: SecurityManager should initialize with locked keystore
2026-01-09T00:38:50.964049 [INFO] [SecurityManager] [INFO] Encrypted keystore unlocked
2026-01-09T00:38:50.965726 [INFO] [SecurityManager] [INFO] Generated secure key: secure_key
00:01 +13 -1: SecurityManager getPrivateKey fallback - plaintext key
00:01 +13 -1: SecurityManager should initialize with locked keystore
2026-01-09T00:38:50.982792 [INFO] [Keystore] [INFO] Added key pair for legacy_key.
2026-01-09T00:38:50.982892 [WARNING] [SecurityManager] [WARNING] Retrieved PLAINTEXT key for legacy_key - migration recommended (SEC-008)
00:01 +14 -1: SecurityManager getPrivateKey fallback - locked warning
00:01 +14 -1: SecurityManager should initialize with locked keystore
2026-01-09T00:38:51.232698 [INFO] [SecurityManager] [INFO] Encrypted keystore unlocked
2026-01-09T00:38:51.234154 [INFO] [SecurityManager] [INFO] Generated secure key: secure_key
2026-01-09T00:38:51.234214 [INFO] [SecurityManager] [INFO] Encrypted keystore locked
2026-01-09T00:38:51.234259 [WARNING] [SecurityManager] [WARNING] Encrypted key requested but keystore is locked: secure_key
00:01 +15 -1: SecurityManager getStatus reporting
00:01 +16 -1: Some tests failed.

Consider enabling the flag chain-stack-traces to receive more detailed exceptions.
For example, 'dart test --chain-stack-traces'.
